parameters:
  terraformVersion: ''
  workingDirectory: ''
  serviceConnection: ''
  backendResourceGroup: ''
  backendStorageAccount: ''
  backendContainer: ''
  backendKey: ''

steps:
# -----------------------------
# Install Terraform
# -----------------------------
- task: Bash@3
  displayName: Install Terraform
  inputs:
    targetType: inline
    script: |
      set -e
      echo "Installing Terraform v${{ parameters.terraformVersion }}"
      wget -q https://releases.hashicorp.com/terraform/${{ parameters.terraformVersion }}/terraform_${{ parameters.terraformVersion }}_linux_amd64.zip
      unzip -q terraform_${{ parameters.terraformVersion }}_linux_amd64.zip
      sudo mv terraform /usr/local/bin/
      terraform version

# -----------------------------
# Terraform Init
# -----------------------------
- task: TerraformTaskV4@4
  displayName: Terraform Init
  inputs:
    provider: azurerm
    command: init
    workingDirectory: ${{ parameters.workingDirectory }}
    backendServiceArm: ${{ parameters.serviceConnection }}
    backendAzureRmResourceGroupName: ${{ parameters.backendResourceGroup }}
    backendAzureRmStorageAccountName: ${{ parameters.backendStorageAccount }}
    backendAzureRmContainerName: ${{ parameters.backendContainer }}
    backendAzureRmKey: ${{ parameters.backendKey }}